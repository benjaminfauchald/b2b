#!/bin/bash

# Validate Puppeteer Configuration Script
# This script ensures all Puppeteer configurations are set to use large viewport sizes

echo "ğŸ”§ Validating Puppeteer Configuration..."
echo "========================================="

CONFIG_VALID=true

# Check Claude settings file
echo "ğŸ“‹ Checking Claude settings (.claude/settings.json)..."
if [ -f ".claude/settings.json" ]; then
    if grep -q "toolDefaults" .claude/settings.json && grep -q "1920" .claude/settings.json; then
        echo "âœ… Claude toolDefaults configured with large viewport"
    else
        echo "âŒ Claude toolDefaults missing or incorrect"
        CONFIG_VALID=false
    fi
else
    echo "âŒ Claude settings file not found"
    CONFIG_VALID=false
fi

# Check CLAUDE.md for browser configuration
echo "ğŸ“‹ Checking CLAUDE.md for browser configuration..."
if [ -f "CLAUDE.md" ]; then
    if grep -q "Browser Testing & Puppeteer Configuration" CLAUDE.md && grep -q "1920" CLAUDE.md; then
        echo "âœ… CLAUDE.md contains browser configuration guidelines"
    else
        echo "âŒ CLAUDE.md missing browser configuration section"
        CONFIG_VALID=false
    fi
else
    echo "âŒ CLAUDE.md file not found"
    CONFIG_VALID=false
fi

# Check common Puppeteer config file
echo "ğŸ“‹ Checking common Puppeteer config file..."
if [ -f "test/puppeteer/puppeteer_config.js" ]; then
    if grep -q "1920" test/puppeteer/puppeteer_config.js && grep -q "1080" test/puppeteer/puppeteer_config.js; then
        echo "âœ… Common Puppeteer config file exists with correct viewport"
    else
        echo "âŒ Common Puppeteer config has incorrect viewport settings"
        CONFIG_VALID=false
    fi
else
    echo "âŒ Common Puppeteer config file missing"
    CONFIG_VALID=false
fi

# Check key test files
echo "ğŸ“‹ Checking key test files for correct viewport..."
TEST_FILES=(
    "test/puppeteer/linkedin_discovery_postal_code_3_companies_test.js"
    "test/puppeteer/user_login_test.js"
    "test/puppeteer/linkedin_discovery_test.js"
)

for file in "${TEST_FILES[@]}"; do
    if [ -f "$file" ]; then
        if grep -q "1920" "$file" && grep -q "1080" "$file"; then
            echo "âœ… $file: Correct viewport configuration"
        else
            echo "âš ï¸  $file: May have old viewport settings"
        fi
    else
        echo "âš ï¸  $file: File not found"
    fi
done

echo ""
echo "ğŸ¯ VALIDATION SUMMARY:"
echo "======================="

if [ "$CONFIG_VALID" = true ]; then
    echo "âœ… All critical configurations are valid"
    echo "âœ… Puppeteer tools will use large viewport (1920x1080)"
    echo "âœ… Screenshots will capture full page content"
    echo ""
    echo "ğŸš€ Configuration is ready for use!"
else
    echo "âŒ Some configurations are missing or incorrect"
    echo "ğŸ”§ Please review the failed checks above"
    echo ""
    echo "ğŸ“ To fix issues:"
    echo "1. Ensure .claude/settings.json has toolDefaults section"
    echo "2. Ensure CLAUDE.md has browser configuration guidelines"
    echo "3. Ensure test/puppeteer/puppeteer_config.js exists"
    echo "4. Update test files to use 1920x1080 viewport"
fi

echo ""
echo "ğŸ“š For more information, see CLAUDE.md section:"
echo "   'ğŸ–¥ï¸ Browser Testing & Puppeteer Configuration'"