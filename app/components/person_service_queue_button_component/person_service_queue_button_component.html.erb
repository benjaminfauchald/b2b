<div class="<%= card_classes %>" 
     data-service="<%= service_name %>"
     data-controller="service-queue"
     data-service-queue-service-name-value="<%= service_name %>">
  <div class="flex items-center mb-4">
    <div class="flex-shrink-0 w-10 h-10 mr-3 flex items-center justify-center">
      <svg class="w-8 h-8 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <% case icon %>
        <% when "user-group" %>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        <% when "search" %>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        <% when "email" %>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        <% end %>
      </svg>
    </div>
    <h3 class="<%= heading_classes %>">
      <%= title %>
    </h3>
  </div>
  
  <div class="mb-4">
    <turbo-frame id="<%= service_name %>_stats">
      <% if show_completion_percentage? %>
        <!-- Completion percentage display -->
        <div class="mb-3">
          <div class="flex items-center justify-between mb-1">
            <span class="text-sm font-medium text-blue-700 dark:text-white"><%= title %> Completion</span>
            <span class="text-sm font-medium text-blue-700 dark:text-white"><%= completion_percentage %>%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
            <div class="bg-blue-600 h-2.5 rounded-full" style="width: <%= completion_percentage %>%"></div>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">
            <%= number_with_delimiter(companies_completed) %> of <%= number_with_delimiter(profile_extraction_potential) %> companies processed
          </p>
        </div>
      <% else %>
        <div class="<%= text_muted_classes %>">
          <p data-available-count="<%= service_name %>"><%= number_with_delimiter(companies_needing_service) %> companies need processing</p>
          <p data-queue-stat="<%= queue_name %>"><%= number_with_delimiter(queue_depth) %> in queue</p>
        </div>
      <% end %>
    </turbo-frame>
  </div>
  
  <form data-service-queue-target="form" 
        data-action="submit->service-queue#submit" 
        action="<%= action_path %>" 
        method="post">
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    <div class="mb-4">
      <label for="<%= service_name %>_count" class="<%= label_classes %>">Batch Size</label>
      <input type="number" 
             name="count" 
             id="<%= service_name %>_count"
             value="<%= [companies_needing_service, 100].min %>" 
             min="1" 
             max="<%= companies_needing_service > 0 ? [companies_needing_service, 1000].min : 1000 %>"
             class="<%= input_classes %>"
             data-service-queue-target="countInput"
             data-max-available="<%= companies_needing_service %>" />
    </div>
    
    <button type="submit" 
            class="<%= button_classes %>"
            data-service-queue-target="submitButton"
            <%= companies_needing_service == 0 ? 'disabled' : '' %>>
      Queue Processing
    </button>
  </form>
</div>